
var domain={user:'http:\/\/my.65.com\/',platform:'http:\/\/www.65.com\/',api:'http:\/\/api.65.com\/',pic:'http:\/\/hnlogin\/platform\/'};var url={u:window.location.href,api:'http:\/\/api.65.com\/',pic:'http:\/\/hnlogin\/platform\/',platform:'http:\/\/www.65.com\/'};var timeout=null;$(function(){$("#allgame").hover(function(){$(".game-list").fadeIn(100);},function(){$(".game-list").fadeOut(100);});$("#login-htn,.login-link").live('click',function(){window.open('http://my.65.com/login.html?url='+url.u);});$(".registet-link").live('click',function(){window.open('http://www.65.com/account/register.html?url='+url.u);});$(".collect").click(function(){Head.AddFavorite(window.location,document.title);});$(".setindex").click(function(){Head.SetHome(this,window.location);});$('.t-log-out').live('click',function(){Status.LoginOut();});var current=new Array;current[0]="0px";current[1]="83px";current[2]="168px";current[3]="253px";current[4]="338px";current[5]="423px";current[6]="508px";current[7]="593px";current[8]="678px";$(".navul a").hover(function(){var index=$(this).attr("data-index");$(".navul a").removeClass("current");$('.navbg').css({"left":current[index]});$(this).addClass("current");},function(){var ind=$(".navul a.navnow").attr("data-index");$(".navul a").removeClass("current");$('.navbg').css({"left":current[ind]});$('.navul a:eq('+ind+')').addClass("current");});$("#seatxt").focus(function(){$("#ser_con").addClass("onfocus");}).blur(function(){$("#ser_con").removeClass("onfocus");});$(window).bind("scroll",function(){var top=$(this).scrollTop();if(top>=110){$("#nav").addClass('navfix');}else{$("#nav").removeClass('navfix');}});});var Init=function(){Status.LogStatus();Head.GameList();};$(function(){Init();});var Head={AddFavorite:function(sURL,sTitle){try{window.external.addFavorite(sURL,sTitle);}catch(e){try{window.sidebar.addPanel(sTitle,sURL,"");}catch(e){alert("加入收藏失败，请使用Ctrl+D进行添加");}}},SetHome:function(obj,vrl){try{obj.style.behavior='url(#default#homepage)';obj.setHomePage(vrl);}catch(e){if(window.netscape){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");}catch(e){alert("此操作被浏览器拒绝！\n请在浏览器地址栏输入“about:config”并回车\n然后将 [signed.applets.codebase_principal_support]的值设置为'true',双击即可。");}
var prefs=Components.classes['@mozilla.org/preferences-service;1'].getService(Components.interfaces.nsIPrefBranch);prefs.setCharPref('browser.startup.homepage',vrl);}}},GameList:function(){$.getJSON(url.api+'65api/mplantform_info.php?callback=?',{action:'get_game'},function(res){if(res.code==1){$('.web-game-sum').html('网页游戏('+res.web_total+')');$('.hand-game-sum').html('手机游戏('+res.m_total+')');var wlen=res.webgame.length;var mlen=res.mgame.length;var w_list='';var m_list='';var status='';for(var i=0;i<wlen;i++){if(res.webgame[i].status=='1'){status='<em class="ico-1 hot-ico"></em>';}else if(res.webgame[i].status=='2'){status='<em class="ico-1 news-ico"></em>';}else if(res.webgame[i].status=='3'){status='<em class="ico-1 test-ico"></em>';}else{status='';}
w_list+='<li><a href="'+res.webgame[i].game_url+'" target="_blank"><font>'+res.webgame[i].game_name+'</font>'+status+'</a></li>';}
for(var j=0;j<mlen;j++){if(res.mgame[j].status=='1'){status='<em class="ico-1 hot-ico"></em>';}else if(res.mgame[j].status=='2'){status='<em class="ico-1 news-ico"></em>';}else if(res.mgame[j].status=='3'){status='<em class="ico-1 test-ico"></em>';}else{status='';}
m_list+='<li><a href="'+res.mgame[j].game_url+'" target="_blank"><font>'+res.mgame[j].game_name+'</font>'+status+'</a></li>';}}
$('.web-game-list').html(w_list);$('.hand-game-list').html(m_list);});}};var Status={LogStatus:function(){var logstatus=$(".logstatus");$.ajax({url:url.api+'65user/login_status.php?callback=?',type:"GET",dataType:"json",success:function(res){if(res.code=='1'){Status.UserInfo();$.each(logstatus,function(){var tlink=$(this).attr('data-href');$(this).attr("href",tlink);});$('.login-h').css('display','block');$('.username,.user-name').html(res.data.UNAME);$('.user-mes span').html('('+res.data.MSG+')');$('.login-q').css('display','none');}else{$(".loading").hide();$.each(logstatus,function(){var tzurl=$(this).attr('data-href');var tlink='http://my.65.com/login.html?url='+tzurl;$(this).attr("href",tlink);});$('.login-h').css('display','none');$('.login-q').css('display','block');}},error:function(){$(".login-q,.login-h").hide();}});},UserInfo:function(){$.getJSON(url.api+'65user/uservip.php?callback=?',function(da){if(da.code==1){$('.user-vip').addClass('vip-'+da.data.vip);}});},LoginOut:function(){$.getJSON(url.api+'65user/login_out.php?callback=?',function(res){if(res.code==1){Status.LogStatus();}});}}
var apiurl='http://api.65.com/65zxzx/gamelist.php?callback=?';var api={gamepc:function(obj){var cid=$("#pcbox").attr("data-id");var id=$(obj).parent().parent().attr("id");var info=$(obj).attr("data-id");$.getJSON('http://api.65.com/65zxzx/count.php?callback=?',{action:'get_dojf',catid:cid,id:id,info:info},function(da){if(da.code==1){$(obj).addClass('on');setTimeout(function(){$(obj).parent().find('.aspan').remove();},1000);api.getpc(cid,id);}else if(da.code==-2){alert("您已经评测过了！");return false;}else{alert(da.msg);return false;}});},getpc:function(cid,id){$.getJSON('http://api.65.com/65zxzx/count.php?callback=?',{action:'get_yxpc',catid:cid,id:id},function(da){if(da.code==1){$("#"+id).find("a.hg_btn_red span.gpc_sumnum").html(da.list[0].good);$("#"+id).find("a.hg_btn_gree span.gpc_sumnum").html(da.list[0].normal);$("#"+id).find("a.hg_btn_gary span.gpc_sumnum").html(da.list[0].bad);}else{$("#"+id).find("a.hg_btn_red span.gpc_sumnum").html(0);$("#"+id).find("a.hg_btn_gree span.gpc_sumnum").html(0);$("#"+id).find("a.hg_btn_gary span.gpc_sumnum").html(0);}});}}
$(function(){kflist(page);$("#next_yy").click(function(){var bcnum=$('#cur_p').html();var bsum=$('#sum_p').html();if(bcnum==bsum)return false;page+=1;kflist(page);});$("#prev_yy").click(function(){var bcnum=$('#cur_p').html();var bsum=$('#sum_p').html();if(bcnum==1)return false;page-=1;kflist(page);});});function kflist(page){var t=$('.serlist_tab a.current').attr('data-t');var slist='';$.getJSON(apiurl,{action:'web_serverlist',t:t,page:page,end:9},function(da){if(da.code==1){$(".zt_info").find('font').html(da.now);var length=da.list.length;var current_num=page;var sum=Math.ceil(da.count/9);var summ=(sum==0)?1:sum;if(sum==0){sum==1};for(var i=0;i<length;i++){slist+='<tr><td>'+da.list[i].o_d+'</td><td>'+da.list[i].o_t+'</td><td><a target="_blank" href="'+da.list[i].url.home+'" class="w-g-name">'+da.list[i].game_name+'</a></td><td><a target="_blank" href="'+da.list[i].play_url+'">'+da.list[i].server_num+'</a></td></tr>';}
$("#cur_p").html(page);$("#sum_p").html(summ);$('#serlist_cl').html(slist);}});}
var spage=1;var s='http://api.65.com/65zxzx/count.php?callback=?';var seaapi={ser:function(keyword){var newlist='';$.getJSON(s,{action:'search',page:1,end:15,keyword:keyword},function(da){if(da.code==1){var len=da.list.length;for(var i=0;i<da.list.length;i++){newlist+='<li><a class="abs new_b_img" href="'+da.list[i].url+'" target="_blank"><img class="lazy ant_02 imgopa8" src="'+da.list[i].thumb+'" alt="'+da.list[i].title+'"></a><h3 class="abs new_name ell"><a class="" href="'+da.list[i].url+'" target="_blank">'+da.list[i].title+'</a></h3><p class="abs new_info"><span class="l_source">来源：'+da.list[i].source+'</span><span class="l_author">作者：'+da.list[i].editor+'</span><span class="l_time">'+da.list[i].time+'</span></p><p class="abs new_des">'+da.list[i].description+'</p><p class="abs new_bq">标签：'+da.list[i].keywords+'</p><a class="abs new_golink" href="'+da.list[i].url+'" target="_blank">阅读全文</a></li>';}
$("#searchlist").html(newlist);var sum=da.count;var pagenum=Math.ceil(sum/15);if(sum==0||pagenum==1){$('#pages').html('');return false;}else{$('#pages').pagination({pages:pagenum});}}else{var linone='<li class="nolist"><img src="http://hnlogin/news/images/tip_n.jpg"/></li>';$("#searchlist").html(linone);}});},serpage:function(page){var newlist='';var key=$("#seatxt").val();var keyword='';if(key==''){if(location.href.indexOf("?")>=0){var urlinfo=window.location.href;if(location.href.indexOf("#")>=0){var keyz=decodeURI(urlinfo.split("?")[1].split("=")[1].split("#")[0]);keyword=(keyz=='')?'':keyz;}else{var keyz=decodeURI(urlinfo.split("?")[1].split("=")[1]);keyword=(keyz=='')?'':keyz;}}else{keyword='';}}else{keyword=key;}
$.getJSON(s,{action:'search',page:page,end:15,keyword:keyword},function(da){if(da.code==1){var len=da.list.length;for(var i=0;i<da.list.length;i++){newlist+='<li><a class="abs new_b_img" href="'+da.list[i].url+'" target="_blank"><img class="lazy ant_02 imgopa8" src="'+da.list[i].thumb+'" alt="'+da.list[i].title+'"></a><p class="abs new_name ell"><a class="" href="'+da.list[i].url+'" target="_blank">'+da.list[i].title+'</a></p><p class="abs new_info"><span class="l_source">来源：'+da.list[i].source+'</span><span class="l_author">作者：'+da.list[i].editor+'</span><span class="l_time">'+da.list[i].time+'</span></p><p class="abs new_des">'+da.list[i].description+'</p><p class="abs new_bq">标签：'+da.list[i].keywords+'</p><a class="abs new_golink" href="'+da.list[i].url+'" target="_blank">阅读全文</a></li>';}
$("#searchlist").html(newlist);}else{var linone='<li class="nolist"><img src="http://hnlogin/news/images/tip_n.jpg"/></li>';$("#searchlist").html(linone);}});}}
if(location.href.indexOf("search")>=0){if(location.href.indexOf("?")>=0){var urlinfo=window.location.href;if(location.href.indexOf("#")>=0){var keyz=decodeURI(urlinfo.split("?")[1].split("=")[1].split("#")[0]);var keyword=(keyz=='')?'':keyz;}else{var keyz=decodeURI(urlinfo.split("?")[1].split("=")[1]);var keyword=(keyz=='')?'':keyz;}}else{var keyword='';}
seaapi.ser(keyword);}
function getUrlParam(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(reg);if(r!=null)return unescape(r[2]);return'';}
function getLocalTime(time,type){var date=new Date(time*1000);var month=date.getMonth()+1<10?"0"+(date.getMonth()+1):date.getMonth()+1;var currentDate=date.getDate()<10?"0"+date.getDate():date.getDate();var hh=date.getHours()<10?"0"+date.getHours():date.getHours();var mm=date.getMinutes()<10?"0"+date.getMinutes():date.getMinutes();if(type=='m/d'){return month+"/"+currentDate;}else if(type=='H:i'){return hh+":"+mm;}}