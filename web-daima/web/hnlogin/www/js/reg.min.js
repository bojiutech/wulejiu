
$(function(){$('#yhm-register').click(function(){$(this).addClass('current').siblings('li').removeClass('current');$("#content").find("div.reg-content").fadeOut(0);$("#content").find("div#register-fs1").fadeIn(500);});$('#phone-register').click(function(){$(this).addClass('current').siblings('li').removeClass('current');$("#content").find("div.reg-content").fadeOut(0);$("#content").find("#register-fs12").fadeIn(500);});$(".lg-slides-btn").click(function(){$(".lg-slides").toggleClass("on");});});function tips(msg,index,type,obj){if(type=='right'){$(obj).attr('status','right').removeClass("hz_reg_txt2");$('.hz_prompt:eq('+index+')').html('<div class="hz_success"></div>');}else{$(obj).attr('status','error').addClass("hz_reg_txt2");$('.hz_prompt:eq('+index+')').html('<div class="hz_prompt_error">'+msg+'</div>');}}
function check_uname(obj, index) {
    var uname = $(obj).val(); if (/^[0-9a-zA-Z_]+$/.test(uname)) {
        if (uname.length < 6 || uname.length > 22) { tips('账号长度不符合要求', index, 'error', obj); }
        else {
            $.ajax({ type: "GET", url: '/Public/Register.ashx', data: { action: 'check_uname', uname: uname }, dataType: "json",
                success: function (data) {
                    if (data.code == '1') { tips('', index, 'right', obj); }
                    else { tips(data.msg, index, 'error', obj); } 
                } 
            })
        } 
    }
else{tips('输入账号格式不正确',index,'error',obj);}}
function check_upwd(obj,index){var upwd=$(obj).val();if(/^[0-9a-zA-Z_]+$/.test(upwd)){if(upwd.length<6||upwd.length>22){tips('密码长度不符合要求',index,'error',obj);}else{tips('',index,'right',obj);}}else{tips('输入密码格式不正确',index,'error',obj);}}
function check_rpwd(obj,index,pwd){var upwd=$(pwd).val();var rpwd=$(obj).val();if(/^[0-9a-zA-Z_]+$/.test(rpwd)){if(rpwd.length<6||rpwd.length>22){tips('密码长度不符合要求',index,'error',obj);}else if(upwd!=rpwd){tips('两次密码输入不一致',index,'error',obj);}else{tips('',index,'right',obj);}}else{tips('输入密码格式不正确',index,'error',obj);}}
function check_agrre_show(e){if($(e).parent().hasClass("on")){$(e).attr('status','right');$(e).parent().siblings('.hz_prompt2').html('<div class="hz_success"></div>');}else{$(e).attr('status','error');$(e).parent().siblings('.hz_prompt2').html('<div class="hz_prompt_error">请阅读用户协议并勾选同意</div>');}}
function check_rname(obj,index){
var rname=$(obj).val();if(rname==null||rname==''||rname=='undefined'){tips('真实姓名不能为空',index,'error',obj);return false;}
if(/^[\u4E00-\u9FA5\uF900-\uFA2D]*$/.test(rname)){tips('真实姓名输入正确',index,'right',obj);}else{tips('真实姓名输入不正确',index,'error',obj);}}
function check_icard(obj,index){var icard=$(obj).val();if(icard.length==15){if(isValidityBrithBy15IdCard(icard)==true){tips('身份证号码输入正确',index,'right',obj);}else{tips('身份证号码输入错误',index,'error',obj);}}else if(icard.length==18){var a_idCard=icard.split("");if(isValidityBrithBy18IdCard(icard)&&isTrueValidateCodeBy18IdCard(a_idCard)){tips('身份证号码输入正确',index,'right',obj);}else{tips('身份证号码输入错误',index,'error',obj);}}else{tips('身份证号码格式不正确',index,'error',obj);}}
function isTrueValidateCodeBy18IdCard(a_idCard){var sum=0;var ValideCode=[1,0,10,9,8,7,6,5,4,3,2];var Wi=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1];if(a_idCard[17].toLowerCase()=='x'){a_idCard[17]=10;}
for(var i=0;i<17;i++){sum+=Wi[i]*a_idCard[i];}
valCodePosition=sum%11;if(a_idCard[17]==ValideCode[valCodePosition]){return true;}
return false;}
function isValidityBrithBy18IdCard(idCard18){var year=idCard18.substring(6,10);var month=idCard18.substring(10,12);var day=idCard18.substring(12,14);var temp_date=new Date(year,parseFloat(month)-1,parseFloat(day));if(temp_date.getFullYear()!=parseFloat(year)||temp_date.getMonth()!=parseFloat(month)-1||temp_date.getDate()!=parseFloat(day)){return false;}
return true;}
function isValidityBrithBy15IdCard(idCard15){var year=idCard15.substring(6,8);var month=idCard15.substring(8,10);var day=idCard15.substring(10,12);var temp_date=new Date(year,parseFloat(month)-1,parseFloat(day));if(temp_date.getYear()!=parseFloat(year)||temp_date.getMonth()!=parseFloat(month)-1||temp_date.getDate()!=parseFloat(day)){return false;}
return true;}
function getCookie(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");return(arr=document.cookie.match(reg))?unescape(arr[2]):'';}
function check_genForm() {
    check_uname('#r_uname', 0); check_upwd('#r_upwd', 1); check_rpwd('#r_upwd2', 2, '#r_upwd'); check_rname('#r_name', 3); check_icard('#r_icard', 4); check_agrre_show("#lg-slides1"); var flg1 = $('#r_uname').attr('status'); var flg2 = $('#r_upwd').attr('status'); var flg3 = $('#r_upwd2').attr('status'); var flg4 = $('#r_name').attr('status'); var flg5 = $('#r_icard').attr('status'); var flg6 = $('#lg-slides1').attr('status'); if (flg1 == 'right' && flg2 == 'right' && flg3 == 'right' && flg4 == 'right' && flg5 == 'right' && flg6 == 'right') {
        var _uname = $("#r_uname").val(); var _upwd = $("#r_upwd").val(); var _rpwd = $("#r_upwd2").val(); var _rname = $("#r_name").val(); var _icard = $("#r_icard").val();var _promoter = $("#promoter").val();
        $.ajax({ type: "GET", url: "/Public/Register.ashx", dataType: "json", 
        data: {action:'register', uname: _uname, upwd: _upwd, rpwd: _rpwd, rname: _rname, icard: _icard,promoter:_promoter },
            success: function (res) {
                if (res.code == '1') { var url = getUrlParam("url"); $('body').append('<div style="display:none;">' + res.ucsynlogin + '</div>'); window.location = (url == '') ? '/index.aspx' : url; }
else{alert(res.msg);}}});}else{return false;}}
function check_tel(obj, index) {
    var regix = /^[1]+[3,4,5,6,7,8,9]+\d{9}$/; if ($(obj).val() == "" || !regix.test($(obj).val())) { tips('请输入正确的手机号码', index, 'error', obj); }
    else {
        $.ajax({ type: "GET", url: '/Public/ghost.ashx', data: { action: 'check_uname', u: $(obj).val() }, dataType: "json",
success:function(data){if(data.code=='1'){tips('',index,'right',obj);}else{tips('该手机号码已经注册, 请进行登录。',index,'error',obj);}}})}}
function send_msg(obj){check_tel('#telnum',6);var telFlg=$('#telnum').attr('status');if(telFlg=='error')return false;var tflg=60;$(obj).attr('disabled',true);$(obj).html('请稍后');var _phone=$("#telnum").val();$.getJSON('/Public/ghost.ashx',{p:_phone},function(data){if(data.code!=1){alert(data.msg);return false;}});var int=setInterval(function(){$(obj).html(tflg+'秒重发');if(tflg==0){$(obj).html('发送验证码');tflg=60;$(obj).attr('disabled',false);clearInterval(int);}
tflg--;},1000);}
function check_code(obj,index){var vcode=$(obj).val();if(vcode==''||vcode==null||vcode=='undefined'){tips('请输入验证码',index,'error',obj);}else{tips('',index,'right',obj);}}
function check_telForm() {
    check_code('#r_quan', 5); check_tel('#telnum', 6); check_code('#r_telyzm', 7); check_upwd('#pwd2', 8); check_rpwd('#pwd3', 9, '#pwd2'); check_rname('#t_name', 10); /*check_icard('#t_icard', 11);*/ check_agrre_show("#lg-slides2"); var flg1 = $('#telnum').attr('status'); var flg2 = $('#r_telyzm').attr('status'); var flg3 = $('#pwd2').attr('status'); var flg4 = $('#pwd3').attr('status'); var flg5 = $('#t_name').attr('status'); var flg6 = $('#t_icard').attr('status'); var flg7 = $('#r_quan').attr('status'); var flg8 = $('#lg-slides2').attr('status'); if (flg1 == 'right' && flg2 == 'right' && flg3 == 'right' && flg4 == 'right' && flg5 == 'right' && flg6 == 'right' && flg7 == 'right' && flg8 == 'right') {
        var _telnum = $("#telnum").val(); var _msg_code = $("#r_quan").val(); var _phone_code = $("#r_telyzm").val(); var _upwd = $("#pwd2").val(); var _rpwd = $("#pwd3").val(); var _rname = $("#t_name").val(); var _icard = $("#t_icard").val();
        $.ajax({ type: "GET", url: "/Public/ghost.ashx", dataType: "json", data: { action: 'tel_register', msg_code: _msg_code, telnum: _telnum, phone_code: _phone_code, upwd: _upwd, rpwd: _rpwd, rname: _rname, icard: _icard },
success:function(res){if(res.code=='1'){var url=getUrlParam("url");$('body').append('<div style="display:none;">'+res.ucsynlogin+'</div>');window.location=(url=='')?'/Public/ghost.ashx':url;}else{alert(res.msg);}}});}else{return false;}}
function getUrlParam(name)
{var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(reg);if(r!=null)return unescape(r[2]);return'';}